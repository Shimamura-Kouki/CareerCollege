# 2019年 後期 期末試験

試験の回答は、以下の通りにすること。

- １問あたり１ファイルに記述。ファイル名は「1-1.txt」でも「問1-1.txt」でも可。フォーマットはtext、拡張子は.txtとする
- 文字コードはUTF-8のすること

試験の注意事項は以下の通り

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も「１問あたり10点」を満点とし、問題があったら適宜減点する

提出は、以下の通り

- 授業内に提出する場合は、ファイルサーバ内の所定のフォルダの中に「自分の名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「自分の名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出(提出期限は1/27)

## (問1)乱数の生成

「1～100までの間の乱数」を出力するコードを書きなさい。

## (問2)推測困難なtokenの生成

「推測困難なtokenの生成」を出力するコードを書きなさい。    
本設問では一端、16byte以上の空間があれば「推測困難」とみなします。    

## (問3)「簡単なサイコロ関数の作成」の作成

「nDm」の表記(例: 1d6 , 2d8 など)を文字列で受け取り、その結果を返す関数を書きなさい。    
関数名は「dice」とします。    

## (問4)均一な確率のがちゃ

「全ての出現頻度が同じ確率」のがちゃを出力するコードを書きなさい。    
がちゃに使うデータは以下のものをコピペしてコードに入れなさい。    

```
$cards = [
	1 => 'スライム',
	2 => 'オーク',
	3 => 'グリフォン',
	4 => 'ドラゴン',
	5 => 'ラストモンスター',
];
```

## (問5)不均一な確率のがちゃ

「カードによって出現頻度が異なる」がちゃを出力するコードを書きなさい。    
がちゃに使うデータは以下のものをコピペしてコードに入れなさい。    
以下のうち、probabilityの値が「確率」になります。

```
$cards = [
	['id' => 1,'name' => 'スライム', 'probability' => 50],
	['id' => 2,'name' => 'オーク', 'probability' => 20],
	['id' => 3,'name' => 'グリフォン', 'probability' => 15],
	['id' => 4,'name' => 'ドラゴン', 'probability' => 10],
	['id' => 5,'name' => 'ラストモンスター', 'probability' => 5],
];
```

## (問6)トランザクションを使うSQL文の作成：有料がちゃ

有料課金がちゃを引くために必要なSQLを、トランザクションを使って適切に書きなさい。    
また、カードを引く前に「有料課金の残高が足りているかどうか」をSQLで確認しなさい。    

- user_idは2016とする
- userテーブルの残高(money)を取得：PHPプログラムであればif文等でチェック。今回はSQLのみなのでチェック処理はオミット
- userテーブルのmoneyの値を100、減算
- user_cardテーブルにinsert。引いたカードID(card_id)は114とする

```
CREATE TABLE user (
  user_id int unsigned NOT NULL,
  money int unsigned ,
  PRIMARY KEY(user_id)
);
```

```
CREATE TABLE user_card (
  user_card_id int unsigned NOT NULL AUTO_INCREMENT,
  user_id int unsigned NOT NULL,
  card_id int unsigned NOT NULL,
  created datetime,
  PRIMARY KEY(user_card_id)
);
```

## Boxがちゃ

Boxがちゃを作成する上で必要な、以下のプログラムを書きなさい。    
なお、前提になる「BOXに入るカードリスト」は、以下のコードを使いなさい。    

```
$box = [
	//
	['name' => 'ゴブリン'],
	['name' => 'ゴブリン'],
	['name' => 'ゴブリン'],
	['name' => 'ゴブリン'],
	['name' => 'ゴブリン'],
	//
	['name' => 'スライム'],
	['name' => 'スライム'],
	['name' => 'スライム'],
	['name' => 'スライム'],
	//
	['name' => 'ドラゴン'],
];
```

### (問7)BOXのリセット

「がちゃBOXのリセット」をするコードを書きなさい。    
情報の保存は「$_SESSION['box_string']」に格納しなさい。

### (問8)BOXから1枚引く

- $_SESSION['box_string'] に保存しているBoxから1枚、カードを引く
- 「引いた後のBox情報」を改めて$_SESSION['box_string'] に保存する
- 引いたカードの情報を出力する(一端、var_dump()でよい)

の挙動をするコードを書きなさい。


## (問9)難問：WoD判定関数の作成

WoD(World of Darkness)の判定システムをプログラム(関数)で書きなさい。    
以下の関数仕様とします。

```
function JudgmentWoD($difficulty, $dicepool) : int
{
}
```

WoD(World of Darkness)の判定システムは、以下の通りになります。    

- 必要な情報は「難易度(2～10の整数): $difficulty」「ダイスプール(0～20以下程度の整数): $dicepool」なので、引数はこの2つ
- 戻り値を「成功度」と呼びます。整数で、初期値は0です。
- 処理は以下の通り
  + ダイスプールの数だけ、10面ダイスを振ります
  + ダイス1つ毎に「難易度」と比較をします
    * ダイスの出目が「難易度以上」なら、成功度を+1します
    * もしダイスの出目が1の場合、成功度を-1します
  + 得られた成功度を戻り値としてreturnします

## (問10)将来について

「自分がサーバサイドを作る」ならどんなゲームを作りたいか？ を自由に書いてください。    

