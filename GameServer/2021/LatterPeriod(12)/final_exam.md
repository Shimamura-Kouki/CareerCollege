# 2021年度 後期 期末試験

試験の回答は、以下の通りにすること。    

- １問あたり１ファイルに記述。ファイル名は、問1なら「1.php」、問1-1なら「1-1.php」のようにする。拡張子は.phpとする
- 文字コードはUTF-8にすること

試験の注意事項は以下の通り    

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も指定がない限り「１問あたり10点」を満点とし、問題があったら適宜減点する

提出は、以下の通り

- 授業内に提出する場合は、Teamsの「前期期末テスト」フォルダの中に「自分の名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「自分の名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出(提出期限は1/23)

## (問1)乱数の生成

「1～100までの間の乱数」を出力するコードを書きなさい。

## (問2)推測困難なtokenの生成

「推測困難なtokenの生成」を出力するコードを書きなさい。    
本設問では一端、16byte以上の空間があれば「推測困難」とみなします。    

## (問3)分岐

以下の処理をif文で実装しなさい。    

- $i に `random_int(0, 3)` の値を代入します
- $i が0なら「Zero」と出力します
- $i が1なら「1」と出力します
- $i が2なら「2nd」と出力します
- $i がそれ以外なら「any」と出力します

## (問4)均一な確率のがちゃ

「全ての出現頻度が同じ確率」のがちゃを出力するコードを書きなさい。    
がちゃに使うデータは以下のものをコピペしてコードに入れなさい。    

```
$cards = [
	1 => 'スライム',
	2 => 'オーク',
	3 => 'グリフォン',
	4 => 'ドラゴン',
	5 => 'ラストモンスター',
];
```

## (問5)RDB

PDOを使って「RDB(MySQL)」に接続するコードを書きなさい。    
接続情報は授業で使った、以下を用いるものとします。    

- mysql
- database名は `tech`
- サーバは `localhost`
- 接続ユーザ名は `tech`
- 接続パスワードは `tech`

## (問6)SQL

database `tech` には、以下のテーブルが存在する。    

```
CREATE TABLE `f_exam` (
  `f_exam_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL DEFAULT '' COMMENT '名前',
  `quantity` int(11) NOT NULL COMMENT '数量',
  `created_at` datetime NOT NULL COMMENT 'レコード作成日付',
  PRIMARY KEY (`f_exam_id`),
  UNIQUE KEY `f_exam_id` (`f_exam_id`)
) ENGINE=InnoDB CHARSET=utf8mb4 COMMENT='テストテーブル'
```

上述にデータを入れるコードを書きなさい。    

- DB接続ハンドルは問5のコードを使って良い。ので、 `require_once('./5.php');` でよい(別途書いてもよい)
- f_exam_id はAUTO_INCREMENT なので、INSERT文には書かないこと
- nameとquantity には好きな値を入れる
- created_at には「INSERTする瞬間の日時」を入れる
  + データはいずれも「外部から入ってきている」前提で、SQL-Injectionに注意すること

## (問7)作成物の提出：30点

授業中に作成したものを提出しなさい。    
以下のチェックを行います。    
dev2.m-fr.netの、アクセス可能なURLを書きなさい。    

- ログイン/認可処理が出来ること(正しい認証情報でログイン出来、正しくない認証情報でハネられること。非ログイン時に「ログイン後TopPage」に遷移できないこと)
- がちゃが引けること
- 「11連がちゃ」が引けること

## (問8)将来について

「自分がサーバサイドを作る」ならどんなゲームを作りたいか？ を自由に書いてください。    

## (問9)難問：WoD判定関数の作成

WoD(World of Darkness)の判定システムをプログラム(関数)で書きなさい。    
以下の関数仕様とします。

```
function JudgmentWoD($difficulty, $dicepool) : int
{
}
```

WoD(World of Darkness)の判定システムは、以下の通りになります。    

- 必要な情報は「難易度(2～10の整数): $difficulty」「ダイスプール(0～20以下程度の整数): $dicepool」なので、引数はこの2つ
- 戻り値を「成功度」と呼びます。整数で、初期値は0です。
- 処理は以下の通り
  + ダイスプールの数だけ、10面ダイスを振ります
  + ダイス1つ毎に「難易度」と比較をします
    * ダイスの出目が「難易度以上」なら、成功度を+1します
    * もしダイスの出目が1の場合、成功度を-1します
  + 得られた成功度を戻り値としてreturnします


