# 2023年度 前期 期末試験

試験の回答は、以下の通りにすること。

- １問あたり１ファイルに記述。ファイル名は「問題番号.php(例: 1.php)」とする。拡張子は.phpであること
- 文字コードはUTF-8にすること

試験の注意事項は以下の通り

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も「書いてある点数(記載がない場合は10点)」を満点とし、問題があったら適宜減点する

提出は、以下の通り

- 授業内に提出する場合は、Teamsの「前期期末テスト」フォルダの中に「自分の名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「自分の名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出

## (問1)メソッドのあるクラス

以下のクラスを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- クラス名: Hoge
    - メソッド
        - メソッド名: calTax
            - 引数: int型
            - 戻り値: 引数の値を 1.1倍した値を返す

インスタンスを作成し、作ったメソッドを実行しなさい。

## (問2)プロパティとアクセサのあるクラス

以下のクラスを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- クラス名: Hoge
    - プロパティ
        - string型 name 初期値 空文字
    - メソッド
        - メソッド名: setName
            - 引数: string型
            - 処理: プロパティ name に引数の値を代入する
            - 戻り値: なし
        - メソッド名: getName
            - 引数: なし
            - 戻り値: プロパティ name の値

インスタンスを作成しなさい。  
その次にsetName()で値を設定しなさい。  
その次に「getName()で取得できた値」をvar_dumpで出力しなさい。  

## (問3)コンストラクタ

以下のクラスを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- クラス名: Hoge
    - コンストラクタ
        - 引数: なし
        - 処理: "created"と出力する

インスタンスを作成し、コンストラクタを動かしなさい。  

## (問4)コンストラクタでデータを設定するクラス

以下のクラスを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- クラス名: Hoge
    - プロパティ
        - int型 id
        - string型 name
    - コンストラクタ
        - 引数: int型, string型
        - 処理: 第一引数を プロパティ id に代入しなさい。第二引数を プロパティ name に代入しなさい。
    - メソッド
        - メソッド名: getId
            - 引数: なし
            - 戻り値: プロパティ io の値
        - メソッド名: getName
            - 引数: なし
            - 戻り値: プロパティ name の値

インスタンスを作成しなさい。  
その次に「getId()で取得できた値」をvar_dumpで出力しなさい。  
その次に「getName()で取得できた値」をvar_dumpで出力しなさい。  

## (問5)簡単な継承のクラス

以下のクラスを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- クラス名: Hoge
    - メソッド
        - メソッド名: baseExec
            - 引数: なし
            - 処理: "exec" と出力する
            - 戻り値: なし
- クラス名: Foo 継承元クラス名 Hoge

Fooクラスのインスタンスを作成し、親クラスHogeにある baseExec() を実行しなさい。  

## (問6)簡単なtraitのクラス

以下のクラスとトレイトを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- トレイト名: HogeTrait
    - メソッド
        - メソッド名: baseExec
            - 引数: なし
            - 処理: "exec" と出力する
            - 戻り値: なし
- クラス名: Hoge
    - トレイト HogeTrait を使う

インスタンスを作成し、トレイトにある baseExec() を実行しなさい。  

## (問7)簡単なinterfaceのクラス

以下のインタフェースとクラスを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- インタフェース名: HogeInterface
    - メソッド
        - 以下のクラス Hoge にある、コンストラクタ以外のすべてのpublicなメソッド
- クラス名: Hoge 継承インタフェース名 HogeInterface
    - コンストラクタ
        - 引数: なし
        - 処理: "created"と出力する
    - メソッド
        - メソッド名: calTax
            - 引数: int型
            - 戻り値: 引数の値を 1.1倍した値を返す

インスタンスを作成し、作成したメソッドを実行しなさい。  


## (問8)SingletonなDB接続クラス

以下のクラスを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- クラス名: Db
    - コンストラクタ
        - アクセス権: priavte
        - 引数: なし
        - 処理: なし
    - メソッド
        - static メソッド名: getHandle
            - 引数: なし
            - 処理: 適切な接続情報で final_exam データベース(スキーマ)に接続する
                - 特記事項: 同じプログラムから2回呼ばれた時に、1回目と同じ接続情報(PDOインスタンス)を返すこと
            - 戻り値: 接続したPDOインスタンスを返す

```
$dbh = Db::getHandle();
var_dump($dbh);
``` 

を2回以上実行し、「何度呼び出しても同じPDOインスタンスが返ってきている事」を確認しなさい。  
セキュリティ等で適切な設定が欠けている場合は減点とする。  
普段の学習サーバには「接続情報が適切であれば接続できる」設定があるので、確認はその情報を使って行うこと。接続情報はテスト開始時に共有します。  

## (問9)SQL: insertとselect

以下のテーブル定義があります。  

```
CREATE TABLE `f_exam` (
  `f_exam_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `no` varbinary(32) NOT NULL DEFAULT '' COMMENT '学籍番号',
  `name` varchar(64) NOT NULL DEFAULT '' COMMENT '名前',
  `quantity` int(11) NOT NULL COMMENT '数量',
  `created_at` datetime NOT NULL COMMENT 'レコード作成日付',
  PRIMARY KEY (`f_exam_id`),
  UNIQUE KEY `f_exam_id` (`f_exam_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='テストテーブル';
```

f_exam_idは「自動でデータが入る」ので、insert文に必要なカラムはno, name, quantity, created_at になります。  

問7のプログラムを使ってPDOインスタンスを取得した後、以下の処理を書きなさい。  

- データのinsert
    - no には「自分の学籍番号」
    - name には「自分の名前」
    - quantity には「適当に好きな数値」
    - created_at には「現在時刻」
- データのselect
    - selectできた全データのvar_dump

セキュリティ等で適切な記述が欠けている場合は減点とする。  

## (問10) Entityクラスの作成: 20点

以下のテーブル定義があります。  
学習サーバにはデータもいくつか入っています。  

```
CREATE TABLE `items` (
  `item_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL DEFAULT '' COMMENT '商品名',
  `price` int(11) NOT NULL COMMENT '金額',
  `created_at` datetime NOT NULL COMMENT 'レコード作成日付',
  `updated_at` datetime NOT NULL COMMENT 'レコード更新日付',
  PRIMARY KEY (`item_id`),
  UNIQUE KEY `item_id` (`item_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品テーブル';
```

```
[final_exam]> select * from items;
+---------+----------------------+-------+---------------------+---------------------+
| item_id | name                 | price | created_at          | updated_at          |
+---------+----------------------+-------+---------------------+---------------------+
|       1 | マザーボード         | 74000 | 2023-08-27 15:30:23 | 2023-08-27 15:30:23 |
|       2 | CPUクーラー          | 12920 | 2023-08-27 15:30:23 | 2023-08-27 15:30:23 |
|       3 | CPU                  | 26970 | 2023-08-27 15:30:23 | 2023-08-27 15:30:23 |
|       4 | グラボ               | 86480 | 2023-08-27 15:30:23 | 2023-08-27 15:30:23 |
|       5 | DDR4 SDRAM メモリ    | 15980 | 2023-08-27 15:30:23 | 2023-08-27 15:30:23 |
+---------+----------------------+-------+---------------------+---------------------+
5 rows in set (0.00 sec)
```

以下のクラスを定義しなさい。  
型宣言もきちんと書くこと。  
明示されていない限り、メソッドはpublic、プロパティはprivateとする  

- クラス名: ItemEntity
    - コンストラクタ
        - 引数: int型
        - 処理: 
            - 問7のクラスを使ってPDOインスタンスを取得する
            - 引数を item_id として、itemsテーブルにselectをしてデータを取得する
                - もしデータがない場合は、 RuntimeException 例外を投げて処理を終了する。エラーメッセージは任意("商品がありません"とかが妥当)
                - もしデータがある場合は、データをプロパティに代入する
    - プロパティ
        - int型 item_id
        - string型 name
        - int型 price
        - string型 created_at
        - string型 updated_at
    - メソッド
        - メソッド名: getName
            - 引数: なし
            - 戻り値: プロパティ name の値
        - メソッド名: getPrice
            - 引数: なし
            - 戻り値: プロパティ price の値

書いたクラスを使って、以下のコードを実装しなさい。  

- 引数に「1～5のいずれかの数値」を与えてインスタンスを作成する
    - getName() と getPrice() でデータを取得してvar_dumpする
- 引数に「1～5以外の数値」を与えて例外を発生させる
    - 例外を正しくキャッチして、getMessage()で取得できる文字列を出力する

## (問11)難問: テストの標準偏差

```
$data = [
    "C" => 80,
    "C++" => 79,
    "Java" => 90,
    "golang" => 65,
    "PHP" => 100,
    "Python" => 95,
    "Ruby" => 60,
    "JavaScript" => 84,
    "Kotlin" => 35,
    "Rust" => 49,
    "Scala" => 70,
];
```

の配列をコードにコピペしなさい。  
この配列は「keyにテストした言語名」「値にテストの点数」が入っています。  
テストの標準偏差を計算して出力するコードを書きなさい。  
「標準偏差の計算方法」は、各自Google等で調べてください。  

計算に必要な「平方根の計算」は、 sqrt() https://www.php.net/manual/ja/function.sqrt.php を使う事で求める事ができます。  
例えば

```
$sq = sqrt(9);
var_dump($sq);
```

の結果は `float(3)` となります。

## (問12)難問: 「二次元配列」での、「生徒の平均値と標準偏差」、「科目の平均値と標準偏差」

```
$data = [
  'Alice' => 
  [
    'PHP' => 79,
    'golang' => 52,
    'JavaScript' => 98,
    'Python' => 92,
    'Ruby' => 65,
  ],
  'Bob' => 
  [
    'PHP' => 57,
    'golang' => 86,
    'JavaScript' => 73,
    'Python' => 89,
    'Ruby' => 64,
  ],
  'Carol' => 
  [
    'PHP' => 92,
    'golang' => 69,
    'JavaScript' => 84,
    'Python' => 65,
    'Ruby' => 65,
  ],
  'Dave' => 
  [
    'PHP' => 64,
    'golang' => 99,
    'JavaScript' => 60,
    'Python' => 65,
    'Ruby' => 82,
  ],
];
```

の配列をコードにコピペしなさい。  
この配列は「生徒毎」「科目毎」のテストの結果が入っています。  
この配列を使って、以下を算出するコードを書きなさい。

- 生徒毎の
    - 平均点数
    - 標準偏差
- 科目毎の
    - 平均点数
    - 標準偏差

