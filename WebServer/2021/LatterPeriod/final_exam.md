# 2021年度 後期 期末試験

試験の回答は、以下の通りにすること。    

- １問あたり１ファイルに記述。ファイル名は、問1なら「1.php」、問1-1なら「1-1.php」のようにする。拡張子は.phpとする
- 文字コードはUTF-8にすること

試験の注意事項は以下の通り    

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も指定がない限り「１問あたり10点」を満点とし、問題があったら適宜減点する

提出は、以下の通り

- 授業内に提出する場合は、Teamsの「後期期末テスト」フォルダの中に「自分の名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「自分の名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出(提出期限は1/27)

## (問1)

PDOを使って「RDB(MySQL)」に接続するコードを書きなさい。    
接続情報は授業で使った、以下を用いるものとします。    

- mysql
- database名は `tech`
- サーバは `localhost`
- 接続ユーザ名は `tech`
- 接続パスワードは `tech`

## (問2)

database `tech` には、以下のテーブルが存在する。    

```
CREATE TABLE `f_exam` (
  `f_exam_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL DEFAULT '' COMMENT '名前',
  `quantity` int(11) NOT NULL COMMENT '数量',
  `created_at` datetime NOT NULL COMMENT 'レコード作成日付',
  PRIMARY KEY (`f_exam_id`),
  UNIQUE KEY `f_exam_id` (`f_exam_id`)
) ENGINE=InnoDB CHARSET=utf8mb4 COMMENT='テストテーブル'
```

上述にデータを入れるコードを書きなさい。    

- DB接続ハンドルは問1のコードを使って良い。ので、 `require_once('./1.php');` でよい(別途書いてもよい)
- f_exam_id はAUTO_INCREMENT なので、INSERT文には書かないこと
- nameとquantity には好きな値を入れる
- created_at には「INSERTする瞬間の日時」を入れる
  + データはいずれも「外部から入ってきている」前提で、SQL-Injectionに注意すること

## (問3)

とある関数 `hoge()` があります。    
この関数は、以下の例外を返す可能性があります。    

- `\Exception` を継承した `\FooException`
- `\Exception` を継承した `\BarException`
- `\Exception`
- 上述以外の例外

関数 `hoge()` をcallした時に、「`\FooException`」「`\BarException`」「`\Exception`」「それ以外の例外」がいずれも正しくキャッチできるコードを書きなさい。    
try ブロックの中は「 `hoge()` の呼び出しのみ」でよいとします。    

## (問4)

クラス `HogeSingleton` を作成しなさい。    
仕様は以下の通りとします(基本的に、いわゆる「GoFのSingletonパターン」クラスの内容です)    

- 外部から `new HogeSingleton()` 出来ないようにする(したらエラーになるようにする)
- `getInstance` メソッドで「`HogeSingleton` クラスのインスタンス」が取得できるようにする
- `getInstance` メソッドで何度インスタンスを取得しても「同一の」インスタンスが取得できるようにする

なお、以下のコードが追加されている場合は、別途加点します。    

- `clone` と `unserialize()` が、双方ともできないようにする：+5点

## (問5)(小難問

静的変数を使って「フィボナッチ数列のを出力する関数」を作成しなさい。    

静的変数については https://www.php.net/manual/ja/language.variables.scope.php#language.variables.scope.static を確認しなさい。    

```
function test() {
    static $a = 0; // これが静的変数
    echo $a;
    $a++;
}
```

フィボナッチ数列 については各自検索して調べてください。    

> 初めは[0, 1]。それ以降は「前２つの数字を足した数字」である。    
> そのため、数列は 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, ... となる。    

仕様は以下の通りとします。    

- 1回目に関数をcallした時は「0」が出力される
- 2回目に関数をcallした時は「1」が出力される
- 3回目に関数をcallした時は「1」が出力される
- 4回目に関数をcallした時は「2」が出力される
- 5回目に関数をcallした時は「3」が出力される

上述で作成した関数を、for文を使って15回ほど呼び出して確認をするコードを一緒に書きなさい。    

## (問6)

「推測困難なtoken」を作成するコードを書きなさい。    

## (問7): 40点

授業中に作成したものを提出しなさい。    
以下のチェックを行います。    
dev2.m-fr.netの、アクセス可能なURLを書きなさい。    

- 認証と認可が適切に動いていること(ログインが出来ること、不適切な情報でログインが出来ないこと、非ログイン時に「ログイン後TopPageにアクセスできないこと)
- 入金と出金が入力できること
- 検索を含む「一覧」が出力されること
- ページネーションとソートが動くこと。またその時に検索条件やページ数やソートの情報が適切に維持されること
