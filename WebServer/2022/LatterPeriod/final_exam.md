# 2022年度 後期 期末試験

試験の回答は、以下の通りにすること。    

- １問あたり１ファイルに記述。ファイル名は、問1なら「1.php」のようにする。拡張子は.phpとする
- 文字コードはUTF-8にすること

試験の注意事項は以下の通り    

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も指定がない限り「１問あたり10点」を満点とし、問題があったら適宜減点する

提出は、以下の通り

- 提出ファイルはzipで1ファイルにまとめる
- 授業内に提出する場合は、授業最後の指示に従って提出
- 授業外で提出する場合は教務経由で提出(提出期限は1/24)

## (問1)

PDOを使って「RDB(MySQL)」に接続するコードを書きなさい。    
接続情報は授業で使った、以下を用いるものとします。    

- mysql
- database名は `final_exam`
- サーバは `localhost`
- 接続ユーザ名は `final_exam_user`
- 接続パスワードは `final_exam_pass`

## (問2)

database `final_exam` には、以下のテーブルが存在する。    

```
CREATE TABLE `f_exam` (
  `f_exam_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL DEFAULT '' COMMENT '名前',
  `quantity` int(11) NOT NULL COMMENT '数量',
  `created_at` datetime NOT NULL COMMENT 'レコード作成日付',
  PRIMARY KEY (`f_exam_id`),
  UNIQUE KEY `f_exam_id` (`f_exam_id`)
) ENGINE=InnoDB CHARSET=utf8mb4 COMMENT='テストテーブル'
```

上述にデータを入れるコードを書きなさい。    

- DB接続ハンドルは問1のコードを使って良い。ので、 `require_once('./1.php');` でよい(別途書いてもよい)
- f_exam_id はAUTO_INCREMENT なので、INSERT文には書かないこと
- nameとquantity には好きな値を入れる
- created_at には「INSERTする瞬間の日時」を入れる
  + データはいずれも「外部から入ってきている」前提で、SQL-Injectionに注意すること

## (問3)

とある関数 `hoge()` があります。    
この関数は、以下の例外を返す可能性があります。    

- `\Exception` を継承した `\FooException`
- `\Exception` を継承した `\BarException`
- `\Exception`
- 上述以外の例外

関数 `hoge()` をcallした時に、「`\FooException`」「`\BarException`」「`\Exception`」「それ以外の例外」がいずれも正しくキャッチできるコードを書きなさい。    
例外をキャッチした後の処理は「メッセージの出力」「`exit;` によるコードの終了」程度でよいです。  
また、try ブロックの中は「 `hoge()` の呼び出しのみ」でよいとします。    

## (問4)

クラス `HogeSingleton` を作成しなさい。    
仕様は以下の通りとします(基本的に、いわゆる「GoFのSingletonパターン」クラスの内容です)    

- 外部から `new HogeSingleton()` 出来ないようにする(したらエラーになるようにする)
- `getInstance()` メソッドで「`HogeSingleton` クラスのインスタンス」が取得できるようにする
- `getInstance()` メソッドで何度インスタンスを取得しても「同一の」インスタンスが取得できるようにする

## (問5)

「推測困難なtoken」を作成するコードを書きなさい。    
"推測困難なtoken"の定義は、いったん「16バイト以上の空間があれば推測困難である」とします。  

## (問6): 50点

授業中に作成したものを提出しなさい。以下のチェックを行います。    
チェックはすべて「管理画面」です。  
dev2.m-fr.netの、アクセス可能なURLを書きなさい。    

- 不適切な認証情報でエラーとなり、エラーが連続したらログインロックされること(DB内の情報を見て確認します
- 適切な認証情報でログインできること。またログイン後に一覧画面にアクセスができ、非ログイン状態では一覧画面にアクセスできないこと
- 問い合わせの一覧が適切に出力され、検索が機能していること(検索条件による絞り込み + 検索条件の保持)
- 返信ボタンで「問い合わせ詳細」に遷移し、詳細情報が出力されること
- 詳細画面から「返信する」で返信情報が一通りupdateされること

なお、インターンシップなどで「授業の公欠が続き、かつ動画で授業が追いかけられていない」場合、別途検討するので、その旨をかいておいてください。  
(基本的には「教務への状況のヒアリング」と「インターンシップ時に学んだことの確認(口頭)」となります)
